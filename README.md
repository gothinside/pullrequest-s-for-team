Интрукция для запуска серивса.
Для запуска необходимо заполнить .env file(см .env.example) и вести make docker_compose. Желательно запускать через docker compose, а не docker-compose.
Чтобы запустить тесты для начала надо поднять тестовое бд и сгенерировать mock'и(make mockgen), поднять тестовое бд и запустить тесты можно через make run_main_test. Отдельно запускайте make e2e-test для запуска e2e тестов(изменено 17.11.2025). Т.К бд тестовое .env file не прилагается. Данные можно заполнить вручную.

ЕСЛИ У ВАС СТАРАЯ ВЕРСИЯ docker в MAKEFILE есть запуск и для старых версий(постфикс old) через docker-compose(на новых версиях он может не работать).


Ход решения:

В качестве структуры проекта выбран project loyaut, где файлы распределены по доменам(DDD).
Весь код расплоложен в папке internal, отдельно расположены тесты.
Тестовое покрытие 75%.(с e2e там больше получается).
Дополнительное задание(сбор статистики).
Для сбора статистика я создал метод GET /users/GetStat, который получает ID пользователя и выводит, сколько раз он был назначен на ревью(переназначения не уменькают это количество т.к статистика введется по тому, сколько раз ОН БЫЛ НАЗНАЧЕН).
Для тестирования роутеров и бд я использовал mocky, базы данных я поднимал в основном для работы интеграционных тестов репозиториев.
Дополнительное задание(массовая деактивация членов команды).
Для этого я создал методв POST /team/deactivation {user_id}. Тут ничего кроме деактивации не происходит(все обернуто в транзакцию само собой).

Я решил не устанавлить уровень изоляции Serialize для всей бд, потому что посчитал что серивсом будет пользоваться мало людей ( в оснвном сотрудники которых скажем не больше 200 человек) и вероятность аномалий связанных с этими уровнями(Фантомное и неповторяющееся чтение) исключены и не являются критичными для сервиса.

Очень неплохим решением было бы также использовать транзакционный менеджер, чтобы не мешать логику с реализацией, но я все же решил оставить tr в неоторых метдотах, потому что посчитал что это будет излишнм усложнением для этого задания, хотя в дальнейшем с расширением преокта можно было бы это реализовать.

Что делать если в команде все неактивны? Я решил просто не добавлять ревьюров, но сам PR создавать(в заднии указано 0..2 логика из этого).


Проблемы с которыми я столкнуся:
Первичный ключ с текстовым типом данных является очень плохим решением для бд, но все решил оставить, т.к добавлять отдельный целочисленный ключ посчитал нецесообразным, т.к. поиск бы происходил все равно по индетификатору. Я использовал VARCHAR(256), подразумевается что индетификаторы длиннее водить не будут.
Кроме Open и Merged в задании не указано могут ли быть потенциально с развитием проекта другие состояния. т.к состояния всего два я решил не декомпозировать таблицу, но если подразумевалось, что состояний может стать больше в целях оптимизации можно будет в дальнейшем ее декомпозировать.
Что будет если массово деактировать членов команды, надо ли будет менять is_active = false пользователя на другого иил нет. Я решил их оставлять на ревью.

Отдельный вопрос логики работы с пользователями:
Как происходит добавление и обновление пользователей. Обновление и добавление происходит только через AddTeam, что как по мне не очень хорошо, лучше было бы добавить отдельный эндпоинт для этого, В задание про это ничего. 
Также нет никой безопасноти, кто угодно по сути из сотрудников может создавать PullRequest, кто угодно может создавать команду и т.д. Я решил, что в задании подразумевалось оснвной уклон сделать на логику с работой PR'ов так, поэтому никаких допонительных мер безопасноти для сервсиса я не добавил.

17.11.2025
Добавил докеры для запуска e2e тестов, изменил makefile для удобства запусков юнит и е2е тестов(юнит тесты включает и интеграционные тесты), изменил структуру папки с тестами для удобства. СМ.( 0761e281aeff24c18e0539802488e3c376aa2fa6 commit).

18.11.2025
Добавил нагрузочное тестирование. Результаты можете посмотреть в папке test/loat_test/res.txt, 4 ошибки там из-за коллизий(иногда генерируются одинаковые айдишники из-за этого ошибка 400 Already exist, а код ошибки проверяется на 201 и 200, но эти ошибки не в счет по итогу 100%). Также оптимизровал некоторые методы, потоу что до этого сбор статистики очень ухудшал показатели, хотя и без это было <100ms. make с запуском не прилагаю, потому что я запускал из докера. Консинстентность данных соблюдена.
Изменил метод деактивации - раньше он принимал id команды, теперь название и выводит саму команду, его тоже чуть оптимизоровал.
Также изменил принцип добавление PR, если в команде все неактивны.

19.11.2025
Изменил make и docker чтобы он был совместим со старыми версиями, я не стал добавлять контекст, так что если у вас не будет работать, 
